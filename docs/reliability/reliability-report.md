# Звіт про надійність системи

## 1. Таблиця знайдених проблем

| № | Проблема | Fault | Error | Failure | Критичність | Статус |
| :-- | :--- | :--- | :--- | :--- | :--- | :--- |
| 1 | Відсутній глобальний таймаут API | Відсутній `timeout` у `axios.create` | Запит зависає у pending | Інтерфейс блокується, користувач не отримує дані | **High** | ✅ Виправлено |
| 2 | Відсутній Error Boundary у React | Відсутній компонент-пастка винятків | Некеровані помилки в дочірніх компонентах | Весь UI падає при одній помилці | **High** | ⚠️ Відкрито |
| 3 | Відсутня валідація `min` (ціна) | Не перевіряється мінімальне значення | У базі зберігаються нульові або від’ємні ціни | Помилки під час відображення або розрахунків | **Medium** | ⚠️ Відкрито |
| 4 | Ризик зависання при оновленні токена | Немає таймауту у refresh-запиті | Сервер недоступний, запит не завершується | Авторизація зависає, користувач не може увійти | **High** | ✅ Виправлено |
| 5 | Відсутня обробка помилок завантаження зображень | Відсутній fallback або catch | Виняток при збоях завантаження | UI показує порожнє місце | **Low** | ⚠️ Відкрито |
| 6 | Занадто широке `except Exception` | Перехоплюються всі винятки | Реальна причина приховується | Неможливо визначити джерело проблеми | **Medium** | ⚠️ Відкрито |
| 7 | Replace логіка без rollback у `update_dish` | Видаляються інгредієнти без перевірки нових | Тимчасово dish без ingredient-записів | Страва може залишитися без інгредієнтів | **High** | ⚠️ Відкрито |

---

## 2. Приклади "До" і "Після"

### Проблема 1 і 4 — Відсутні таймаути у `api.js`

**До:**
```javascript
const apiClient = axios.create({
  baseURL: API_URL + VERSION,
});

// ... в interceptor ...
const response = await axios.post(API_URL + 'token/refresh/', {
  refresh: refreshToken
});
```

**Після:**
```
const apiClient = axios.create({
  baseURL: API_URL + VERSION,
  timeout: 10000, // 10 секунд
});

const response = await axios.post(API_URL + 'token/refresh/', {
  refresh: refreshToken
}, {
  timeout: 5000, // 5 секунд
});
```

### Патерн надійності:
- Timeout — обмеження часу виконання запиту, щоб уникнути зависань.

### Проблема 6 — Занадто широке перехоплення виключень
**До:**
```
except Exception as e:
    self.stderr.write(self.style.ERROR(f"Error creating manager: {e}"))
```

**Після:**
```
except IntegrityError as e:
    self.stderr.write(self.style.ERROR(f"Database constraint error: {e}"))
```
### Патерн надійності:
- Вузьке перехоплення (Targeted Catch) — перехоплення лише очікуваних типів помилок.


### Проблема 7 — Replace логіка без rollback у update_dish
**До:**
```
DishIngredient.objects.filter(dish=dish_instance).delete()
DishIngredient.objects.bulk_create(dish_ingredients)
```

**Після:**
```
with transaction.atomic():
    DishIngredient.objects.filter(dish=dish_instance).delete()
    DishIngredient.objects.bulk_create(dish_ingredients)
```
### Патерн надійності:
- Transaction — забезпечення цілісності даних при збої.

## 3. Опис застосованих патернів надійності

| Патерн | Призначення | Де застосовано |
| :-- | :-- | :-- |
| **Timeout** | Обмежує час очікування відповіді від зовнішніх сервісів | `api.js` — глобальний клієнт і refresh-токен |
| **Error Boundary / Fallback UI** | Запобігає падінню всього інтерфейсу | React UI (у планах) |
| **Guard Clause** | Забезпечує ранню перевірку даних | Перевірка `min` для ціни |
| **Fallback** | Використовує запасний варіант при збої | Завантаження зображень |
| **Targeted Catch** | Перехоплює лише очікувані типи помилок | `create_initial_manager.py` |
| **Transaction** | Захищає від неповних оновлень даних | `update_dish` у `services/dishes.py` |

---

## 4. Відкриті проблеми та подальші кроки

| № | Опис | Ризик | Рекомендації |
| :-- | :-- | :-- | :-- |
| 2 | Відсутній Error Boundary у React | High | Додати компонент `ErrorBoundary` для обробки непередбачених помилок UI |
| 3 | Валідація `min` (ціна) | Medium | Додати перевірку мінімального значення на рівні форми і backend |
| 5 | Завантаження зображень без fallback | Low | Додати запасне зображення при збої |
| 6 | Надто широке `except Exception` | Medium | Залишити тільки очікувані помилки (`IntegrityError`, `ValueError`, тощо) |
| 7 | Оновлення страв без rollback | High | Обгорнути оновлення у `transaction.atomic()` |

---

## 5. Висновки

Після аналізу коду виявлено 7 основних проблем, що впливають на **надійність та стійкість системи доставки**.  
Виправлені таймаути значно зменшили ризики зависання застосунку, однак залишаються відкритими питання валідації, UI-захисту та транзакційної цілісності.  

Подальша робота передбачає:
- Додавання Error Boundary у фронтенді.  
- Покращення валідації вхідних даних.  
- Впровадження додаткових reliability-тестів на 404, помилки бази даних та таймаути.
